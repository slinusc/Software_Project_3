<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Boxicons CSS -->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder@1.13.0/dist/Control.Geocoder.css" />

    <!-- Stylesheet -->
    <link rel="stylesheet" href="../static/css/style.css" />

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">

    <!-- Bootstrap CSS -->
    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"> -->

    <!-- Einbindung von Chart.js im Header -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>

    <title>CycleBuddy</title>
</head>
<body>
    <nav class="sidebar close">
        <header>
            <div class="image-text">
                <span class="image">
                    <img src="../static/images/img2.png" alt="logo">
                </span>

                <div class="text header-text">
                    <span class="name">CycleBuddy</span>
                    <span class="profession">Navigation</span>
                </div>
            </div>

            <i class='bx bx-chevron-right toggle'></i>
        </header>

        <div class="menu-bar">
            <div class="menu">
                <ul class="menu-links">
                    <li class="nav-link">
                        <a href="/">
                            <i class='bx bx-map icon'></i>
                            <span class="text nav-text">Navigation</span>
                        </a>
                    </li>
                    <li class="nav-link">
                        <a href="/analytics">
                            <i class='bx bxs-bar-chart-alt-2 icon'></i>
                            <span class="text nav-text">Analytics</span>
                        </a>
                    </li>
                    <li class="nav-link">
                        <a href="/about">
                            <i class='bx bx-bell icon'></i>
                            <span class="text nav-text">About</span>
                        </a>
                    </li>
                </ul>
            </div>

            <div class="bottom-content">
                <li class="">
                    <a href="#">
                        <i class='bx bx-log-out icon'></i>
                        <span class="text nav-text">Log out</span>
                    </a>
                </li>

                <li class="mode">
                    <div class="moon-sun">
                        <i class='bx bx-moon icon moon'></i>
                        <i class='bx bx-sun icon sun'></i>
                    </div>
                    <span class="mode-text text">Dark Mode</span>

                    <div class="toggle-switch">
                        <span class="switch"></span>
                    </div>
                </li>

            </div>
        </div>
    </nav>

    <section class="home">
        <div class="container">
            <h1>Analytics</h1>

            <div class="Statistic1">
                <!-- Erstelle ein Canvas-Element für das Diagramm -->
                <canvas id="amenityChartCanvas"></canvas>

                <!-- Dropdown-Menü für verschiedene Amenities -->
                <select id="amenitySelect">
                    <option value="bicycle_parking">Bicycle Parking</option>
                    <option value="bicycle_repair_station">Repair Station</option>
                    <option value="bicycle_rental">Bicycle Rental</option>
                    <option value="compressed_air">Compressed Air</option>
                    <option value="drinking_water">Drinking Water</option>
                    <option value="shelter">Shelter</option>
                </select>

                <script>
                    // Funktion zum Laden der JSON-Daten
                    function loadFlaskServerData(amenityType, callback) {
                        fetch('/amenities_per_canton', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ amenity_type: amenityType }),
                        })
                            .then(response => response.json())
                            .then(data => callback(data))
                            .catch(error => console.error('Error fetching Flask Server data:', error));
                    }

                    // Funktion zum Aktualisieren des Diagramms basierend auf der ausgewählten Amenität
                    function updateChart(selectedAmenity) {
                        loadFlaskServerData(selectedAmenity, function (data) {
                            // Daten aus dem Flask-Server direkt verwenden
                            var amenityCountPerCanton = {};

                            // Fülle amenityCountPerCanton mit den Daten aus data
                            data.forEach(function (entry) {
                                amenityCountPerCanton[entry._id] = entry.count;
                            });

                            // Sortiere die Daten nach der Anzahl der Amenities (absteigend)
                            var sortedData = Object.keys(amenityCountPerCanton)
                                .sort((a, b) => amenityCountPerCanton[b] - amenityCountPerCanton[a]);

                            // Diagramm aktualisieren
                            var ctx = document.getElementById('amenityChartCanvas').getContext('2d');
                            if (window.amenityChart) {
                                window.amenityChart.destroy(); // Zerstöre das vorhandene Diagramm, wenn es existiert
                            }
                            window.amenityChart = new Chart(ctx, {
                                type: 'bar',
                                data: {
                                    labels: sortedData,
                                    datasets: [{
                                        label: 'Anzahl ' + selectedAmenity.replace('_', ' ').capitalize() + ' pro Kanton',
                                        data: sortedData.map(canton => amenityCountPerCanton[canton]),
                                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                        borderColor: 'rgba(75, 192, 192, 1)',
                                        borderWidth: 1
                                    }]
                                },
                                options: {
                                    scales: {
                                        y: {
                                            beginAtZero: true
                                        }
                                    }
                                }
                            });
                        });
                    }

                    // Hinzufügen einer capitalize-Funktion zum Formatieren von Amenities für das Diagrammlabel
                    String.prototype.capitalize = function () {
                        return this.charAt(0).toUpperCase() + this.slice(1);
                    };

                    // Initiieren des Diagramms mit der Standard-Amenität (Drinking Water)
                    updateChart('drinking_water');

                    // Dropdown-Änderungsereignis hinzufügen, um das Diagramm bei Auswahl zu aktualisieren
                    document.getElementById('amenitySelect').addEventListener('change', function () {
                        var selectedAmenity = this.value;
                        updateChart(selectedAmenity);
                    });
                </script>
            </div>

            <div class="Statistic2">
                <!-- Erstelle ein Canvas-Element für das Diagramm -->
                <canvas id="amenityBarChart"></canvas>

                <!-- Dropdown-Menü für verschiedene Distanzen -->
                <select id="radiusSelect" onchange="updateBarChart()">
                    <option value="1000">1000m</option>
                    <option value="2000">2000m</option>
                    <option value="5000">5000m</option>
                    <option value="10000">10000m</option>
                </select>

                <script>
                    // ... (Ihr bestehender JavaScript-Code) ...
                </script>
            </div>

        </div>
    </section>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder@1.13.0/dist/Control.Geocoder.js"></script>

    <!-- JavaScript-Code -->
    <script type="module" src="../static/js/menu.js"></script>

    <!-- analytics.js (Ihre bestehende JavaScript-Datei) -->
    <script type="module" src="../static/js/analytics.js"></script>

    <!-- analytics.js (Ihre bestehende JavaScript-Datei) -->
    <script type="module" src="../static/js/nearest.js"></script>


</body>
</html>


